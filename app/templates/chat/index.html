<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://s4.zstatic.net/ajax/libs/marked/15.0.7/marked.min.js"></script>
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://s4.zstatic.net/npm/katex@0.16.9/dist/katex.min.css">
    <!-- KaTeX JS -->
    <script defer src="https://s4.zstatic.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <!-- KaTeX Auto-render Extension -->
    <script defer src="https://s4.zstatic.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Monetag -->
    <script src="https://ligheechoagool.com/88/tag.min.js" data-zone="145589" async data-cfasync="false"></script>
</head>
<body>
    <div class="app-container">
        <!-- 遮罩层 -->
        <div class="sidebar-overlay"></div>
        
        <!-- 侧边栏 -->
        <div class="conversation-sidebar {{ 'collapsed' if session.get('sidebar_collapsed') else '' }}">
            <div class="sidebar-header">
                <h2>对话历史</h2>
                <button id="new-chat-btn" class="new-chat-btn">新对话</button>
            </div>
            
            <!-- 对话列表 -->
            <div class="conversation-list" id="conversations-list">
                <!-- 对话列表项会通过 JavaScript 动态添加 -->
            </div>

            <!-- 用户信息 -->
            <div class="user-profile">
                <div class="user-avatar">
                    {{ current_user.username[0].upper() }}
                </div>
                <div class="user-info">
                    <div class="user-name" id="user-name-display">{{ current_user.username }}</div>
                    <div class="user-status">在线</div>
                </div>
                <button class="logout-btn">
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 侧边栏切换按钮 -->
        <!-- 移动端侧边栏切换按钮 -->
        <button class="sidebar-toggle">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
        </button>
        <!-- 桌面端侧边栏切换按钮 -->
        <button class="collapse-btn {{ 'collapsed' if session.get('sidebar_collapsed') else '' }}">
            <svg class="collapse-icon" viewBox="0 0 24 24">
                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
        </button>

        <!-- 主聊天区域 -->
        <div class="chat-main">
            <div class="chat-overlay"></div>
            <div class="chat-overlay-d"></div>
            <!-- 在聊天界面顶部添加模型选择器 -->
            <div class="model-select">
                <div class="model-select-header">
                    <span class="selected-model"></span>
                    <span class="arrow"></span>
                </div>
                <div class="model-select-options">
                    <div class="model-option" data-value="DeepSeek-R1">
                        <img src="{{ url_for('static', filename='models/DeepSeek-R1.png') }}" alt="DeepSeek-R1" class="model-option-icon">
                        <span>DeepSeek-R1</span>
                    </div>
                    <div class="model-option" data-value="DeepSeek-V3">
                        <img src="{{ url_for('static', filename='models/DeepSeek-V3.png') }}" alt="DeepSeek-V3" class="model-option-icon">
                        <span>DeepSeek-V3</span>
                    </div>
                    <div class="model-option" data-value="Doubao-1.5-lite">
                        <img src="{{ url_for('static', filename='models/Doubao-1.5-lite.png') }}" alt="Doubao-1.5-lite" class="model-option-icon">
                        <span>Doubao-1.5-lite</span>
                    </div>
                    <div class="model-option" data-value="Doubao-1.5-pro">
                        <img src="{{ url_for('static', filename='models/Doubao-1.5-pro.png') }}" alt="Doubao-1.5-pro" class="model-option-icon">
                        <span>Doubao-1.5-pro</span>
                    </div>
                    <div class="model-option" data-value="Doubao-1.5-pro-256k">
                        <img src="{{ url_for('static', filename='models/Doubao-1.5-pro-256k.png') }}" alt="Doubao-1.5-pro-256k" class="model-option-icon">
                        <span>Doubao-1.5-pro-256k</span>
                    </div>
                    <div class="model-option" data-value="Doubao-1.5-vision-pro">
                        <img src="{{ url_for('static', filename='models/Doubao-1.5-vision-pro.png') }}" alt="Doubao-1.5-vision-pro" class="model-option-icon">
                        <span>Doubao-1.5-vision-pro</span>
                    </div>
                    <div class="model-option" data-value="Gemini-2.5-pro">
                        <img src="{{ url_for('static', filename='models/Gemini-2.5-pro.png') }}" alt="Gemini-2.5-pro" class="model-option-icon">
                        <span>Gemini-2.5-pro</span>
                    </div>
                    <div class="model-option" data-value="Gemini-2.5-flash">
                        <img src="{{ url_for('static', filename='models/Gemini-2.5-flash.png') }}" alt="Gemini-2.5-flash" class="model-option-icon">
                        <span>Gemini-2.5-flash</span>
                    </div>
                    <div class="model-option" data-value="Gemini-2.0-flash">
                        <img src="{{ url_for('static', filename='models/Gemini-2.0-flash.png') }}" alt="Gemini-2.0-flash" class="model-option-icon">
                        <span>Gemini-2.0-flash</span>
                    </div>
                    <div class="model-option" data-value="Qwen3">
                        <img src="{{ url_for('static', filename='models/Qwen3.png') }}" alt="Qwen3" class="model-option-icon">
                        <span>Qwen3</span>
                    </div>
                    <div class="model-option" data-value="QwQ">
                        <img src="{{ url_for('static', filename='models/QwQ.png') }}" alt="QwQ" class="model-option-icon">
                        <span>QwQ</span>
                    </div>
                    <div class="model-option" data-value="QwQ-Preview">
                        <img src="{{ url_for('static', filename='models/QwQ-Preview.png') }}" alt="QwQ-Preview" class="model-option-icon">
                        <span>QwQ-Preview</span>
                    </div>
                    <div class="model-option" data-value="QvQ">
                        <img src="{{ url_for('static', filename='models/QvQ.png') }}" alt="QvQ" class="model-option-icon">
                        <span>QvQ</span>
                    </div>
                    <div class="model-option" data-value="Qwen2.5-Instruct">
                        <img src="{{ url_for('static', filename='models/Qwen2.5-Instruct.png') }}" alt="Qwen2.5-Instruct" class="model-option-icon">
                        <span>Qwen2.5-Instruct</span>
                    </div>
                </div>
            </div>
            <!-- 消息区域 -->
            <div id="messages" class="messages">
                <!-- 消息内容将通过 JavaScript 动态添加 -->
            </div>

            <!-- 输入区域 -->
            <div class="input-area">
                <!-- 图片预览区域 -->
                <div id="image-preview-container" class="image-preview-container" style="display: none;">
                    <div class="preview-image-wrapper">
                        <img id="preview-image" src="" alt="预览图片">
                        <button type="button" class="remove-image-btn"=>×</button>
                    </div>
                </div>
                <!-- 联网搜索按钮 -->
                <button type="button" id="online-search-btn" class="online-search-button">
                    <svg viewBox="0 0 24 24" width="14" height="14">
                        <path d="M17.5,12C17.5,15.04 15.04,17.5 12,17.5C8.96,17.5 6.5,15.04 6.5,12C6.5,8.96 8.96,6.5 12,6.5C15.04,6.5 17.5,8.96 17.5,12M20.59,19.41L17.33,16.15C16.18,17.37 14.59,18 12.97,18C8.83,18 5.5,14.67 5.5,10.5C5.5,6.33 8.83,3 12.97,3C17.1,3 20.5,6.33 20.5,10.5C20.5,12.12 19.87,13.71 18.65,14.87L21.91,18.13L20.59,19.41M13,11H14V10H13V9H12V10H11V11H12V12H11V13H12V14H13V13H14V12H13V11Z" />
                    </svg>
                    <span>联网搜索</span>
                </button>
                <div class="input-row">
                    <textarea 
                        id="message-input" 
                        placeholder="给 Aurora 发送消息..."
                        rows="1"
                    ></textarea>
                    <button class="image-upload-button" type="button"=>
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/>
                        </svg>
                        <input type="file" id="image-upload" accept="image/*" style="display:none">
                    </button>
                    <button class="send-button" type="button">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 会员信息弹窗 -->
        <div id="user-profile-modal" class="user-modal">
            <div class="user-modal-content">
                <div class="user-modal-header">
                    <h3>个人信息</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="user-modal-body">
                    <!-- 用户名修改 -->
                    <div class="user-info-section">
                        <h4>用户信息</h4>
                        <div class="username-display">
                            <span id="profile-username">{{ current_user.username }}</span>
                            <div class="user-buttons">
                                <button class="edit-username-btn">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button id="change-password-btn" class="edit-password-btn">
                                    <i class="bi bi-key"></i>
                                </button>
                            </div>
                        </div>
                        <div class="username-edit" style="display: none;">
                            <input type="text" id="username-input" value="{{ current_user.username }}">
                            <button id="save-username-btn">保存</button>
                            <button id="cancel-username-btn">取消</button>
                        </div>
                    </div>
                    
                    <!-- 会员信息 -->
                    <div class="user-info-section">
                        <h4>会员状态</h4>
                        <div id="membership-info">
                            <div class="loading-spinner">加载中...</div>
                        </div>
                    </div>
                    
                    <!-- 会员权益 -->
                    <div class="user-info-section">
                        <h4>会员权益</h4>
                        <div id="membership-privileges">
                            <!-- 会员权益列表将通过JavaScript动态添加 -->
                        </div>
                    </div>
                    
                    <!-- 余额信息 -->
                    <div class="user-info-section" id="balance-section">
                        <h4>余额信息</h4>
                        <div id="balance-display">
                            <div class="loading-spinner">加载中...</div>
                        </div>
                        <!-- 余额充值 -->
                        <div class="redeem-section">
                            <h4>充值码兑换</h4>
                            <div class="redeem-form">
                                <input type="text" id="money-code-input" placeholder="输入充值码" class="redeem-input" />
                                <button type="button" id="money-redeem-btn" class="redeem-button">充值</button>
                            </div>
                            <div id="money-redeem-result" class="redeem-result"></div>
                        </div>
                    </div>

                    <!-- 兑换兑换码 -->
                    <div class="user-info-section">
                        <h4>会员兑换</h4>
                        <div class="redeem-section">
                            <div class="redeem-form">
                                <input type="text" id="vip-code-input" placeholder="输入会员兑换码" class="redeem-input" />
                                <button type="button" id="vip-redeem-btn" class="redeem-button">兑换</button>
                            </div>
                            <div id="vip-redeem-result" class="redeem-result"></div>
                        </div>
                    </div>

                    <!-- 注销账号 -->
                    <div class="user-info-section">
                        <h4>账号管理</h4>
                        <div class="account-actions">
                            <button type="button" id="deactivate-account-btn" class="danger-button">
                                <i class="bi bi-exclamation-triangle"></i> 注销账号
                            </button>
                        </div>
                    </div>

                    <!-- 获取兑换码链接 -->
                    <div class="get-code-section">
                        <a href="https://afdian.com/a/mchyj" target="_blank" class="get-code-link">
                            <i class="bi bi-gift"></i> 获取兑换码
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>

    <!-- 密码修改弹窗 -->
    <div id="password-modal" class="user-modal">
        <div class="user-modal-content">
            <div class="user-modal-header">
                <h3>修改密码</h3>
                <span class="close-password-modal">&times;</span>
            </div>
            <div class="user-modal-body">
                <div id="password-form">
                    <div class="password-field">
                        <label for="current-password">当前密码</label>
                        <input type="password" id="current-password" placeholder="请输入当前密码">
                    </div>
                    <div class="password-field">
                        <label for="new-password">新密码</label>
                        <input type="password" id="new-password" placeholder="请输入新密码">
                    </div>
                    <div class="password-field">
                        <label for="confirm-password">确认新密码</label>
                        <input type="password" id="confirm-password" placeholder="请再次输入新密码">
                    </div>
                    <div class="password-notice">
                        <p>· 密码长度不能少于6个字符</p>
                        <p>· 建议使用字母、数字和符号的组合</p>
                    </div>
                    <div class="password-buttons">
                        <button id="save-password-btn">保存</button>
                        <button id="cancel-password-btn">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 注销账号确认弹窗 -->
    <div id="deactivate-modal" class="user-modal">
        <div class="user-modal-content">
            <div class="user-modal-header">
                <h3>注销账号确认</h3>
                <span class="close-deactivate-modal">&times;</span>
            </div>
            <div class="user-modal-body">
                <div class="deactivate-warning">
                    <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                    <p class="warning-text">请注意：注销账号将会<strong>永久删除</strong>您的所有数据和会话历史，此操作<strong>不可撤销</strong>。</p>
                </div>
                <div class="deactivate-info">
                    <p>注销后，您将丢失以下内容：</p>
                    <ul>
                        <li>所有聊天记录和会话历史</li>
                        <li>账号关联的会员状态</li>
                        <li>账号中剩余的余额</li>
                        <li>所有个人设置和偏好</li>
                    </ul>
                </div>
                <div class="countdown-section">
                    <p>为确保您理解此操作的严重性，请等待 <span id="countdown-timer">5</span> 秒后再确认。</p>
                </div>
                <div class="deactivate-buttons">
                    <button id="confirm-deactivate-btn" class="danger-button" disabled>确定注销</button>
                    <button id="cancel-deactivate-btn">取消</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>